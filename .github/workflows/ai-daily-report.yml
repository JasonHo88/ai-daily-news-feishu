name: AI资讯日报自动收集

# 触发方式：
# 1. 定时触发：每天UTC 0点（北京时间8点）
# 2. 手动触发：点击按钮即可运行
on:
  schedule:
    # 每天UTC 0点执行（北京时间8:00）
    - cron: '0 0 * * *'
  workflow_dispatch:
    inputs:
      debug:
        description: '调试模式（输出更多信息）'
        required: false
        default: 'false'

# 权限设置
permissions:
  contents: read
  statuses: read

# 任务定义
jobs:
  collect-and-push:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      # 1. 检出代码
      - name: Checkout code
        uses: actions/checkout@v4
        
      # 2. 设置Python环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'
          
      # 3. 安装依赖
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests python-dotenv
          
      # 4. 创建环境变量文件
      - name: Create environment file
        run: |
          echo "FEISHU_WEBHOOK_URL=${{ secrets.FEISHU_WEBHOOK_URL }}" > .env
          cat .env
          
      # 5. 执行AI资讯收集
      - name: Collect AI News
        id: collect
        run: |
          echo "=== 开始收集AI资讯 ==="
          echo "时间: $(date)"
          python collect_ai_news.py
          echo "exit_code=$?" >> $GITHUB_OUTPUT
          
      # 6. 推送结果到飞书（如果成功）
      - name: Push to Feishu
        if: ${{ steps.collect.outputs.exit_code == '0' }}
        run: |
          echo "=== 推送到飞书 ==="
          python push_to_feishu.py
          
      # 7. 发送失败通知（如果失败）
      - name: Notify on failure
        if: ${{ failure() }}
        run: |
          echo "❌ AI资讯收集任务失败！"
          echo "请检查工作流日志。"
          # 可以添加邮件通知、Slack通知等
